<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload and Deletion</title>
    <style>
        html { color-scheme: light dark; }
        body {
            font-family: Tahoma, Verdana, Arial, sans-serif;
            margin: 0 auto;
	    width: 35em;
        }
        .form-container {
            margin-bottom: 20px;
        }
        .files-container {
            margin-bottom: 20px;
        }
        .files-list {
            list-style-type: none;
            padding: 0;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
        }
        .scrolling-menu {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>
<body>

    <div class="form-container">
        <form id="fileForm">
            <label for="file">Upload file:</label>
            <input type="file" id="file" name="file" required>
            <br><br>
            <button type="submit">Upload File</button>
        </form>
    </div>

    <div class="files-container">
        <h3>Uploaded Files</h3>
        <div class="scrolling-menu">
            <ul id="filesList" class="files-list"></ul>
        </div>
    </div>

    <script>
        document.getElementById('fileForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const formData = new FormData();
            const fileInput = document.getElementById('file');
            const file = fileInput.files[0];
            formData.append('file', file);

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateFilesDisplay();
                } else {
                    alert('File upload failed');
                }
            })
            .catch(error => {
                console.error('Error uploading file:', error);
            });

            fileInput.value = '';
        });

        function updateFilesDisplay() {
            fetch('/get-files')
                .then(response => response.json())
                .then(files => {
                    const filesList = document.getElementById('filesList');
                    filesList.innerHTML = '';
                    files.forEach(file => addFile(file));
                })
                .catch(error => {
                    console.error('Error fetching files:', error);
                });
        }

        function addFile(file) {
            const filesList = document.getElementById('filesList');
            const listItem = document.createElement('li');
            listItem.classList.add('file-item');
            
            const fileContent = document.createElement('span');
            fileContent.textContent = `File: ${file.name}`;
            
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.onclick = function() {
                deleteFile(file.name);
                filesList.removeChild(listItem);
            };
            
            listItem.appendChild(fileContent);
            listItem.appendChild(deleteButton);
            filesList.appendChild(listItem);
        }

        function deleteFile(fileName) {
            fetch(`/delete-file/${encodeURIComponent(fileName)}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('File deleted:', fileName);
                } else {
                    alert('File deletion failed');
                }
            })
            .catch(error => {
                console.error('Error deleting file:', error);
            });
        }

        // Initial load of files
        updateFilesDisplay();
    </script>

</body>
</html>

